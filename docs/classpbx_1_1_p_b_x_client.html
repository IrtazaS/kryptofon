<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>VoIP Kryptofon: pbx.PBXClient Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="namespacepbx.html">pbx</a>      </li>
      <li><a class="el" href="classpbx_1_1_p_b_x_client.html">PBXClient</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a>  </div>
  <div class="headertitle">
<h1>pbx.PBXClient Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="pbx::PBXClient" -->
<p>Encapsulates rudimentary functionality of a PBX to list and invite users (peers) to secure calls.  
<a href="#_details">More...</a></p>
<!-- startSectionHeader --><div class="dynheader">
Collaboration diagram for pbx.PBXClient:<!-- endSectionHeader --></div>
<!-- startSectionSummary --><!-- endSectionSummary --><!-- startSectionContent --><div class="dyncontent">
<div class="center"><img src="classpbx_1_1_p_b_x_client__coll__graph.png" border="0" usemap="#pbx_8_p_b_x_client_coll__map" alt="Collaboration graph"/></div>
<map name="pbx_8_p_b_x_client_coll__map" id="pbx_8_p_b_x_client_coll__map">
<area shape="rect" id="node6" href="interfacepbx_1_1_p_b_x_client_1_1_context.html" title="Provides a call&#45;back context for the instance of PBXClient." alt="" coords="197,5,403,229"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center><!-- endSectionContent --></div>

<p><a href="classpbx_1_1_p_b_x_client-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html">Context</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Provides a call-back context for the instance of <a class="el" href="classpbx_1_1_p_b_x_client.html" title="Encapsulates rudimentary functionality of a PBX to list and invite users (peers) to secure calls...">PBXClient</a>.  <a href="interfacepbx_1_1_p_b_x_client_1_1_context.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client_1_1_control_message.html">ControlMessage</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">PBX signaling message sent via call-back to the upper layer.  <a href="classpbx_1_1_p_b_x_client_1_1_control_message.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">CMType</a> { <br/>
&#160;&#160;<a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">_INVALID_</a>, 
<a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">INVITE</a>, 
<a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">RING</a>, 
<a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">ACCEPT</a>, 
<br/>
&#160;&#160;<a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">BYE</a>, 
<a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">INSTANTMESSAGE</a>, 
<a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">LIST</a>, 
<a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">ALIVE</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>PBX Signaling Messages' Types. </p>
 <a href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a197f03a53a7acc796af7d0c484320863">PBXClient</a> (String <a class="el" href="classpbx_1_1_p_b_x_client.html#ab7454d4e5bb1676adbcc01e2deb969ef">host</a>, int <a class="el" href="classpbx_1_1_p_b_x_client.html#aa4b4cb1c8d43643c2e1d3bbf04f5640a">port</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html">Context</a> <a class="el" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324">context</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates new instance of <code><a class="el" href="classpbx_1_1_p_b_x_client.html" title="Encapsulates rudimentary functionality of a PBX to list and invite users (peers) to secure calls...">PBXClient</a></code> that posts messages to specified <code><a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html" title="Provides a call-back context for the instance of PBXClient.">Context</a></code>.  <a href="#a197f03a53a7acc796af7d0c484320863"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a908e59a5f96ac724317c402a4f7ba744">getLocalAddress</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns local IP address.  <a href="#a908e59a5f96ac724317c402a4f7ba744"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a62086db6e1497d23af966f87c148945e">start</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the thread.  <a href="#a62086db6e1497d23af966f87c148945e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2">send</a> (String message)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends message (appended with new-line) to chat server.  <a href="#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a1f32adf70dcb2b5efc78ef00a22bf39d">send</a> (String message, String userId)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends message (appended with new-line) to chat server prefixed with userId.  <a href="#a1f32adf70dcb2b5efc78ef00a22bf39d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a9ec0d49a2b2c47a84b98b8ba265d8798">close</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes the connection gracefully.  <a href="#a9ec0d49a2b2c47a84b98b8ba265d8798"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a726928c4342761e6a39a96e02365d638">sendInvite</a> (String remoteUserId, String localIpAddress, int localUdpPort, String publicKey)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcasts INVITE message.  <a href="#a726928c4342761e6a39a96e02365d638"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#ac80b3f374d478cc3e2333baaa6905840">sendRing</a> (String remoteUserId, String localIpAddress, int localUdpPort, String publicKey)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcasts RING message.  <a href="#ac80b3f374d478cc3e2333baaa6905840"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a712b7b704d26d0974da6a6161f7eff6d">sendAccept</a> (String remoteUserId, String localIpAddress, int localUdpPort, String publicKey)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcasts ACCEPT message.  <a href="#a712b7b704d26d0974da6a6161f7eff6d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a0d3465a16cbcbe10f04292cb091d0699">sendBye</a> (String remoteUserId, String localIpAddress, int localUdpPort)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcasts BYE message.  <a href="#a0d3465a16cbcbe10f04292cb091d0699"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a54cfb627d993b20c25c3ebf701ea6815">sendInstantMessage</a> (String remoteUserId, String encryptedMessage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcasts IMSG message.  <a href="#a54cfb627d993b20c25c3ebf701ea6815"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a3897d8ee1ed84c9946698d33057c4b79">sendListPeers</a> (String regex)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcasts LIST message (to list potential peers)  <a href="#a3897d8ee1ed84c9946698d33057c4b79"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a19f37c8db5173cc41f99d4a887a962ff">run</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Connects socket, then reads messages from server while <code>running</code> flag is enabled.  <a href="#a19f37c8db5173cc41f99d4a887a962ff"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf">report</a> (String style, String str)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reports a system message to log.  <a href="#abd8e80b1b68b3e877bf2ef29f91225bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#acd24d6bd87194f8ae9b0e1b896385e97">reportIncomingTextMessage</a> (String userId, String message)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reports incoming message.  <a href="#acd24d6bd87194f8ae9b0e1b896385e97"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#aa4ae9bc6badf013485cb63e37adf67e3">parseInputMessage</a> (String message)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses input message.  <a href="#aa4ae9bc6badf013485cb63e37adf67e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#afd4a7c777eb3ef62553056bdea31713c">parseControlMessage</a> (String remoteUserId, String[] args, String original)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses control messages.  <a href="#afd4a7c777eb3ef62553056bdea31713c"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#ab7454d4e5bb1676adbcc01e2deb969ef">host</a> = null</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Host name or IP address of the remote chat server.  <a href="#ab7454d4e5bb1676adbcc01e2deb969ef"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#aa4b4cb1c8d43643c2e1d3bbf04f5640a">port</a> = -1</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">TCP port where to connect to on remote chat server.  <a href="#aa4b4cb1c8d43643c2e1d3bbf04f5640a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#acf9f2f6dd971fa08f1781a197545d2db">myID</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Chat client ID when presented to user (== host + ":" + port)  <a href="#acf9f2f6dd971fa08f1781a197545d2db"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">PrintWriter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a126e9c82498f32f661bccca6406eba38">out</a> = null</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Output stream to remote server.  <a href="#a126e9c82498f32f661bccca6406eba38"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">Socket&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d">socket</a> = null</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Instance of the TCP socket to chat server.  <a href="#a5365c6d73f90b8501b1512bf379d0e9d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53">running</a> = false</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates/enables the thread to be running.  <a href="#a129cf7dd7d500a8ccd3eedf44592dd53"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html">Context</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324">context</a> = null</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Event (call-back) context for this instance of the <a class="el" href="classpbx_1_1_p_b_x_client.html" title="Encapsulates rudimentary functionality of a PBX to list and invite users (peers) to secure calls...">PBXClient</a>.  <a href="#a02ab46a6e71f3e5855f604eeb55ad324"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static final String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c">WARN</a> = &quot;logWarn&quot;</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">HTML CSS class for warning and error messages.  <a href="#a8903bf28bd6cf77a754cea13c1890a4c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static final String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpbx_1_1_p_b_x_client.html#a5015382f590ad4c70435467c9f662adf">INFO</a> = &quot;logInfo&quot;</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">HTML CSS class for info messages.  <a href="#a5015382f590ad4c70435467c9f662adf"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Encapsulates rudimentary functionality of a PBX to list and invite users (peers) to secure calls. </p>
<p>The instances of <a class="el" href="classpbx_1_1_p_b_x_client.html" title="Encapsulates rudimentary functionality of a PBX to list and invite users (peers) to secure calls...">PBXClient</a> class expect to be connected to plain public chat server that distributes (broadcasts their messages (terminated by the new-line) to all other connected users (possible kryptofon peers).</p>
<p>Communication with the upper layer (which owns instance of the <a class="el" href="classpbx_1_1_p_b_x_client.html" title="Encapsulates rudimentary functionality of a PBX to list and invite users (peers) to secure calls...">PBXClient</a>) is done using call-backs over the <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html" title="Provides a call-back context for the instance of PBXClient.">PBXClient.Context</a> interface.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mikica B Kocic </dd></dl>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00031">31</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>
<hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="a8e7180b941ddc3c56028157c55678f79"></a><!-- doxytag: member="pbx::PBXClient::CMType" ref="a8e7180b941ddc3c56028157c55678f79" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79">pbx::PBXClient::CMType</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PBX Signaling Messages' Types. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a8e7180b941ddc3c56028157c55678f79"></a><!-- doxytag: member="_INVALID_" ref="a8e7180b941ddc3c56028157c55678f79" args="" -->_INVALID_</em>&nbsp;</td><td>
<p>Invalid CMType. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a8e7180b941ddc3c56028157c55678f79"></a><!-- doxytag: member="INVITE" ref="a8e7180b941ddc3c56028157c55678f79" args="" -->INVITE</em>&nbsp;</td><td>
<p>The message sent to remote peer to start the call. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a8e7180b941ddc3c56028157c55678f79"></a><!-- doxytag: member="RING" ref="a8e7180b941ddc3c56028157c55678f79" args="" -->RING</em>&nbsp;</td><td>
<p>The message sent back from remote peer informing about remote alerting status. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a8e7180b941ddc3c56028157c55678f79"></a><!-- doxytag: member="ACCEPT" ref="a8e7180b941ddc3c56028157c55678f79" args="" -->ACCEPT</em>&nbsp;</td><td>
<p>The message sent back from the remote peer indicating accepted call. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a8e7180b941ddc3c56028157c55678f79"></a><!-- doxytag: member="BYE" ref="a8e7180b941ddc3c56028157c55678f79" args="" -->BYE</em>&nbsp;</td><td>
<p>Indicates call clear down -- either normal or abrupt (like call reject). </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a8e7180b941ddc3c56028157c55678f79"></a><!-- doxytag: member="INSTANTMESSAGE" ref="a8e7180b941ddc3c56028157c55678f79" args="" -->INSTANTMESSAGE</em>&nbsp;</td><td>
<p>Instant message exchanged between users with encrypted messages. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a8e7180b941ddc3c56028157c55678f79"></a><!-- doxytag: member="LIST" ref="a8e7180b941ddc3c56028157c55678f79" args="" -->LIST</em>&nbsp;</td><td>
<p>Query all peers. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a8e7180b941ddc3c56028157c55678f79"></a><!-- doxytag: member="ALIVE" ref="a8e7180b941ddc3c56028157c55678f79" args="" -->ALIVE</em>&nbsp;</td><td>
<p>Respond to Query all pears. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00036">36</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>
<div class="fragment"><pre class="fragment">    {<span class="comment"></span>
<span class="comment">        /** Invalid CMType */</span>
        _INVALID_,
<span class="comment"></span>
<span class="comment">        /** The message sent to remote peer to start the call */</span>
        INVITE, 
        <span class="comment"></span>
<span class="comment">        /** The message sent back from remote peer informing about remote alerting status */</span>
        RING, 
        <span class="comment"></span>
<span class="comment">        /** The message sent back from the remote peer indicating accepted call */</span>
        ACCEPT,
        <span class="comment"></span>
<span class="comment">        /** Indicates call clear down -- either normal or abrupt (like call reject). */</span>
        BYE, 
        <span class="comment"></span>
<span class="comment">        /** Instant message exchanged between users with encrypted messages */</span>
        INSTANTMESSAGE,
        <span class="comment"></span>
<span class="comment">        /** Query all peers */</span>
        LIST,
        <span class="comment"></span>
<span class="comment">        /** Respond to Query all pears */</span>
        ALIVE
    }
</pre></div>
</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a197f03a53a7acc796af7d0c484320863"></a><!-- doxytag: member="pbx::PBXClient::PBXClient" ref="a197f03a53a7acc796af7d0c484320863" args="(String host, int port, Context context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pbx.PBXClient.PBXClient </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html">Context</a>&#160;</td>
          <td class="paramname"> <em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Creates new instance of <code><a class="el" href="classpbx_1_1_p_b_x_client.html" title="Encapsulates rudimentary functionality of a PBX to list and invite users (peers) to secure calls...">PBXClient</a></code> that posts messages to specified <code><a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html" title="Provides a call-back context for the instance of PBXClient.">Context</a></code>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">host</td><td>host name or IP address of the chat server </td></tr>
    <tr><td class="paramname">port</td><td>TCP port </td></tr>
    <tr><td class="paramname">context</td><td>where to log messages (also error and info messages) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00206">206</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00164">pbx.PBXClient.host</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00174">pbx.PBXClient.myID</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00169">pbx.PBXClient.port</a>.</p>
<div class="fragment"><pre class="fragment">    {
        super( <span class="stringliteral">&quot;Chat-&quot;</span> + <a class="code" href="classpbx_1_1_p_b_x_client.html#ab7454d4e5bb1676adbcc01e2deb969ef" title="Host name or IP address of the remote chat server.">host</a> + <span class="stringliteral">&quot;:&quot;</span> + <a class="code" href="classpbx_1_1_p_b_x_client.html#aa4b4cb1c8d43643c2e1d3bbf04f5640a" title="TCP port where to connect to on remote chat server.">port</a> );

        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#ab7454d4e5bb1676adbcc01e2deb969ef" title="Host name or IP address of the remote chat server.">host</a>        = <a class="code" href="classpbx_1_1_p_b_x_client.html#ab7454d4e5bb1676adbcc01e2deb969ef" title="Host name or IP address of the remote chat server.">host</a>;
        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#aa4b4cb1c8d43643c2e1d3bbf04f5640a" title="TCP port where to connect to on remote chat server.">port</a>        = <a class="code" href="classpbx_1_1_p_b_x_client.html#aa4b4cb1c8d43643c2e1d3bbf04f5640a" title="TCP port where to connect to on remote chat server.">port</a>;
        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>     = <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>;
        
        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#acf9f2f6dd971fa08f1781a197545d2db" title="Chat client ID when presented to user (== host + &amp;quot;:&amp;quot; + port)">myID</a> = <a class="code" href="classpbx_1_1_p_b_x_client.html#ab7454d4e5bb1676adbcc01e2deb969ef" title="Host name or IP address of the remote chat server.">host</a> + <span class="stringliteral">&quot;:&quot;</span> + <a class="code" href="classpbx_1_1_p_b_x_client.html#aa4b4cb1c8d43643c2e1d3bbf04f5640a" title="TCP port where to connect to on remote chat server.">port</a>; 
    }
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a9ec0d49a2b2c47a84b98b8ba265d8798"></a><!-- doxytag: member="pbx::PBXClient::close" ref="a9ec0d49a2b2c47a84b98b8ba265d8798" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.close </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Closes the connection gracefully. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00277">277</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00189">pbx.PBXClient.running</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00184">pbx.PBXClient.socket</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>, and <a class="el" href="_crypto_phone_app_8java_source.html#l00647">CryptoPhoneApp.formWindowClosing()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keyword">synchronized</span>( this )
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> = <span class="keyword">false</span>;

            <span class="keywordflow">if</span> ( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a> != null &amp;&amp; ! <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a>.isClosed () ) {
                <span class="keywordflow">try</span> {
                    <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a>.close ();
                } <span class="keywordflow">catch</span>( IOException e ) {
                    <span class="comment">/* ignore */</span>
                }
            }
        }
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a908e59a5f96ac724317c402a4f7ba744"></a><!-- doxytag: member="pbx::PBXClient::getLocalAddress" ref="a908e59a5f96ac724317c402a4f7ba744" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String pbx.PBXClient.getLocalAddress </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns local IP address. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00220">220</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00184">pbx.PBXClient.socket</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01857">CryptoPhoneApp.acceptIncomingCall()</a>, <a class="el" href="_crypto_phone_app_8java_source.html#l01501">CryptoPhoneApp.deferredOnInvite()</a>, and <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">return</span> <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a>.getLocalAddress ().getHostAddress ();
    }
</pre></div>
</div>
</div>
<a class="anchor" id="afd4a7c777eb3ef62553056bdea31713c"></a><!-- doxytag: member="pbx::PBXClient::parseControlMessage" ref="afd4a7c777eb3ef62553056bdea31713c" args="(String remoteUserId, String[] args, String original)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.parseControlMessage </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>remoteUserId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String[]&#160;</td>
          <td class="paramname"> <em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>original</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Parses control messages. </p>
<p>TODO Format messages in XML instead. (It would be too much to do for IP1 course.)</p>
<p>Syntax: </p>
<pre>
     [$] INVITE    local-name   remote-ip-address   remote-udp-port  [ public-key ]   
     [$] RING      local-name   remote-ip-address   remote-udp-port  [ public-key ]
     [$] ACCEPT    local-name   remote-ip-address   remote-udp-port  [ secret-key ]
     [$] BYE       local-name [ remote-ip-address [ remote-udp-port ] ]
     [$] IMSG      local-name   encrypted-message
     [$] LIST    [ username-regex ]
     [$] ALIVE
  </pre> 
<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00377">377</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030">pbx.PBXClient.Context.getUserId()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00164">pbx.PBXClient.host</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00159">pbx.PBXClient.INFO</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a9eed3d789a1b19e9fad7f6249e3bc638">pbx.PBXClient.Context.onAccept()</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#abdbeb774ab4823bddfb30fa7ba60a08e">pbx.PBXClient.Context.onBye()</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a373183a8820460b492e1097ed59d2c4a">pbx.PBXClient.Context.onInstantMessage()</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a9f01161743acfb21113f07611c8630ee">pbx.PBXClient.Context.onInvite()</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#adb4b0fb1ae04c69f971b553467ab73e9">pbx.PBXClient.Context.onRing()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00169">pbx.PBXClient.port</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00296">pbx.PBXClient.report()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00244">pbx.PBXClient.send()</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00321">pbx.PBXClient.parseInputMessage()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        assert args.length &gt;= 1 &amp;&amp; args[0].equals( <span class="stringliteral">&quot;[$]&quot;</span> );

        <span class="comment">/* Parse args[1] as CMType </span>
<span class="comment">         */</span>
        <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a> cmType = <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>._INVALID_;
        
        <span class="keywordflow">if</span> ( args[1].equalsIgnoreCase( <span class="stringliteral">&quot;invite&quot;</span> ) ) {
            cmType = <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.INVITE;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args[1].equalsIgnoreCase( <span class="stringliteral">&quot;ring&quot;</span> ) ) {
            cmType = <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.RING;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args[1].equalsIgnoreCase( <span class="stringliteral">&quot;accept&quot;</span> ) ) {
            cmType = <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.ACCEPT;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args[1].equalsIgnoreCase( <span class="stringliteral">&quot;bye&quot;</span> ) ) {
            cmType = <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.BYE;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args[1].equalsIgnoreCase( <span class="stringliteral">&quot;imsg&quot;</span> ) ) {
            cmType = <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.INSTANTMESSAGE;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args[1].equalsIgnoreCase( <span class="stringliteral">&quot;list&quot;</span> ) ) {
            cmType = <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.LIST;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args[1].equalsIgnoreCase( <span class="stringliteral">&quot;alive&quot;</span> ) ) {
            cmType = <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.ALIVE;
        } <span class="keywordflow">else</span> {
            <span class="keywordflow">return</span>; <span class="comment">// ignore unknown types</span>
        }
        
        String destinationUserId = null;
        
        <span class="comment">/* Parse destination user id, then ignore loop messages and </span>
<span class="comment">         * messages that are not explicitly for us.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ( cmType != <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.LIST &amp;&amp; cmType != <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.ALIVE &amp;&amp; args.length &gt;= 3 ) 
        {
            destinationUserId = args[2];

            <span class="keywordflow">if</span> ( remoteUserId.equalsIgnoreCase( destinationUserId ) ) {
                <span class="keywordflow">return</span>;
            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! destinationUserId.equalsIgnoreCase( <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030" title="Returns configured user ID.">getUserId</a> () ) ) { 
                <span class="keywordflow">return</span>;
            }
        }
<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* [$]  INVITE  local-name remote-ip-address remote-udp-port [ public-key ]</span>
<span class="comment">         *  0     1         2           3              4                  5 opt.      </span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ( args.length &gt;= 5  &amp;&amp; args[1].equalsIgnoreCase( <span class="stringliteral">&quot;invite&quot;</span> ) )
        {
            String publicKey = args.length &gt;= 6 ? args[5] : null;

            <span class="keywordflow">try</span>
            {
                <span class="keywordtype">int</span> <a class="code" href="classpbx_1_1_p_b_x_client.html#aa4b4cb1c8d43643c2e1d3bbf04f5640a" title="TCP port where to connect to on remote chat server.">port</a> = Integer.parseInt( args[4] ); <span class="comment">// remote port</span>

                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a9f01161743acfb21113f07611c8630ee" title="Informs upper layer of incoming INVITE.">onInvite</a>( <span class="keyword">new</span> ControlMessage( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.INVITE,
                        remoteUserId, destinationUserId, args[3], port, publicKey ) );
            }
            <span class="keywordflow">catch</span>( NumberFormatException e )
            {
                <span class="comment">/* ignore message */</span>
            }
        }<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* [$]  RING   local-name remote-ip-address remote-udp-port  [ public-key ]</span>
<span class="comment">         *  0     1         2           3              4                   5</span>
<span class="comment">         */</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args.length &gt;= 5 &amp;&amp; args[1].equalsIgnoreCase( <span class="stringliteral">&quot;ring&quot;</span> ) ) 
        {
            String publicKey = args.length &gt;= 6 ? args[5] : null;

            <span class="keywordflow">try</span>
            {
                <span class="keywordtype">int</span> port = Integer.parseInt( args[4] ); <span class="comment">// remote port</span>

                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#adb4b0fb1ae04c69f971b553467ab73e9" title="Informs upper layer of incoming RING.">onRing</a>( <span class="keyword">new</span> ControlMessage( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.RING,
                        remoteUserId, destinationUserId, args[3], port, publicKey ) );
            }
            <span class="keywordflow">catch</span>( NumberFormatException e )
            {
                <span class="comment">/* ignore message if port is not integer */</span>
            }
        }<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* [$]  ACCEPT  local-name remote-ip-address remote-udp-port [ secret-key ]</span>
<span class="comment">         *  0     1         2           3                  4               5        </span>
<span class="comment">         */</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args.length &gt;= 5 &amp;&amp; args[1].equalsIgnoreCase( <span class="stringliteral">&quot;accept&quot;</span> ) ) 
        {
            String secretKey = args.length &gt;= 6 ? args[5] : null;

            <span class="keywordflow">try</span>
            {
                <span class="keywordtype">int</span> port = Integer.parseInt( args[4] ); <span class="comment">// remote port</span>
                
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a9eed3d789a1b19e9fad7f6249e3bc638" title="Informs upper layer of incoming ACCEPT.">onAccept</a>( <span class="keyword">new</span> ControlMessage( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.ACCEPT, 
                        remoteUserId, destinationUserId, args[3], port, secretKey ) );
            }
            <span class="keywordflow">catch</span>( NumberFormatException e )
            {
                <span class="comment">/* ignore message if port is not integer */</span>
            }
        }<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* [$]   BYE   local-name [ remote-ip-address [ remote-udp-port ] ]</span>
<span class="comment">         *  0     1         2            3                   4      </span>
<span class="comment">         */</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args.length &gt;= 3 &amp;&amp; args[1].equalsIgnoreCase( <span class="stringliteral">&quot;bye&quot;</span> ) ) 
        {
            <span class="keywordflow">try</span>
            {
                String <a class="code" href="classpbx_1_1_p_b_x_client.html#ab7454d4e5bb1676adbcc01e2deb969ef" title="Host name or IP address of the remote chat server.">host</a> = args.length &gt;= 4 ? args[3] : <span class="stringliteral">&quot;&quot;</span>;
                <span class="keywordtype">int</span> port = args.length &gt;= 5 ? Integer.parseInt( args[4] ) : 0;

                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#abdbeb774ab4823bddfb30fa7ba60a08e" title="Informs upper layer of incoming BYE.">onBye</a>( <span class="keyword">new</span> ControlMessage( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.BYE,
                        remoteUserId, destinationUserId, host, port, null ) );
            }
            <span class="keywordflow">catch</span>( NumberFormatException e )
            {
                <span class="comment">/* ignore message if port is not integer */</span>
            }
        }<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* [$]   IMSG   local-name  encrypted-message</span>
<span class="comment">         *  0     1         2              3      </span>
<span class="comment">         */</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args.length &gt;= 4 &amp;&amp; args[1].equalsIgnoreCase( <span class="stringliteral">&quot;imsg&quot;</span> ) ) 
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a373183a8820460b492e1097ed59d2c4a" title="Informs upper layer of incoming IMSG.">onInstantMessage</a>( <span class="keyword">new</span> ControlMessage( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8e7180b941ddc3c56028157c55678f79" title="PBX Signaling Messages&amp;#39; Types.">CMType</a>.INSTANTMESSAGE,
                    remoteUserId, destinationUserId, <span class="stringliteral">&quot;&quot;</span>, 0, args[3] ) );
        }<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* [$]  LIST   [ username-regex ]</span>
<span class="comment">         *  0     1          2 opt.</span>
<span class="comment">         */</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args.length &gt;= 2 &amp;&amp; args[1].equalsIgnoreCase( <span class="stringliteral">&quot;list&quot;</span> ) )
        {
            String myUserId = <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030" title="Returns configured user ID.">getUserId</a> ();

            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5015382f590ad4c70435467c9f662adf" title="HTML CSS class for info messages.">INFO</a>, <span class="stringliteral">&quot;Listing users...&quot;</span> );
            
            <span class="keywordflow">if</span> ( ! myUserId.isEmpty () )
            {
                <span class="keywordflow">if</span> ( args.length &lt; 3 ) <span class="comment">// query all users (without regex)</span>
                { 
                    <span class="comment">/* Respond back to query</span>
<span class="comment">                     */</span>
                    <a class="code" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" title="Sends message (appended with new-line) to chat server.">send</a>( <span class="stringliteral">&quot;[$] ALIVE&quot;</span>, myUserId );
                }
                <span class="keywordflow">else</span>  <span class="comment">// case-insensitive query with regex</span>
                {
                    Pattern p = null;
                    <span class="keywordflow">try</span> {
                        p = Pattern.compile( args[2], Pattern.CASE_INSENSITIVE );
                    } <span class="keywordflow">catch</span> ( Throwable e ) {
                        <span class="comment">/* ignored */</span>
                    }
                    <span class="keywordflow">if</span> ( p != null &amp;&amp; p.matcher( myUserId ).find () )
                    {
                        <span class="comment">/* Respond back to query</span>
<span class="comment">                         */</span>
                        <a class="code" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" title="Sends message (appended with new-line) to chat server.">send</a>( <span class="stringliteral">&quot;[$] ALIVE&quot;</span>, myUserId );
                    }
                }
            }
        }<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* [$]  ALIVE</span>
<span class="comment">         *  0     1   </span>
<span class="comment">         */</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args.length &gt;= 2 
                &amp;&amp; args[1].equalsIgnoreCase( <span class="stringliteral">&quot;alive&quot;</span> ) )
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5015382f590ad4c70435467c9f662adf" title="HTML CSS class for info messages.">INFO</a>, <span class="stringliteral">&quot;-- User &#39;&quot;</span> + remoteUserId + <span class="stringliteral">&quot;&#39; is alive.&quot;</span> );
            <span class="comment">// TODO this might as well update some list of possible peers?</span>
            <span class="comment">// -- but that requires little more functionality on the PBX (chat) server</span>
            <span class="comment">// side.</span>
        }
    }
</pre></div>
</div>
</div>
<a class="anchor" id="aa4ae9bc6badf013485cb63e37adf67e3"></a><!-- doxytag: member="pbx::PBXClient::parseInputMessage" ref="aa4ae9bc6badf013485cb63e37adf67e3" args="(String message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.parseInputMessage </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>message</em>&#160;)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Parses input message. </p>
<p>Syntax: </p>
<pre>
      [ [ &lt;userId&gt; ] : ] &lt;text-or-control&gt;
  </pre><p> where default <em>userId</em> is <code>[Anonymous]</code>.</p>
<p>If the <em>text-or-control</em> begins with "[$]" it represents control message and it will not be displayed to the user. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00321">321</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00377">pbx.PBXClient.parseControlMessage()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00304">pbx.PBXClient.reportIncomingTextMessage()</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="comment">/* Parse input with syntax: [ [ &lt;userId&gt; ] &quot;:: &quot; ] &lt;message&gt;</span>
<span class="comment">         * where default userId is [Anonymous].</span>
<span class="comment">         */</span>
        String[] parts = message.split( <span class="stringliteral">&quot;:: &quot;</span>, 2 );
        String userId = <span class="stringliteral">&quot;[Anonymous]&quot;</span>;
        
        <span class="keywordflow">if</span> ( message.startsWith( <span class="stringliteral">&quot;WWHHOO: &quot;</span> ) ) {
            userId = <span class="stringliteral">&quot;WWHHOO&quot;</span>;
            message = message.substring( 8 );
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( parts.length == 0 ) {
            message = parts[0];
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( parts[0].trim().length () == 0 &amp;&amp; parts.length &gt;= 2 ) {
            message = parts[1];
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( parts.length &gt;= 2 ) {
            userId  = parts[0].trim ();
            message = parts[1];
        } <span class="keywordflow">else</span> {
            message = parts[0];
        }

        <span class="comment">/* Now, check if we have a control message beginning with token [$]</span>
<span class="comment">         * but not comming from the anonymous user.</span>
<span class="comment">         */</span>
        parts = message.trim().split( <span class="stringliteral">&quot;\\s{1,}&quot;</span> );

        <span class="keywordflow">if</span> ( ! userId.equals( <span class="stringliteral">&quot;[Anonymous]&quot;</span> ) 
                &amp;&amp; parts.length &gt;= 1 
                &amp;&amp; parts[0].equals( <span class="stringliteral">&quot;[$]&quot;</span> ) )
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#afd4a7c777eb3ef62553056bdea31713c" title="Parses control messages.">parseControlMessage</a>( userId, parts, message );
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#acd24d6bd87194f8ae9b0e1b896385e97" title="Reports incoming message.">reportIncomingTextMessage</a>( userId, message );
        }
    }
</pre></div>
</div>
</div>
<a class="anchor" id="abd8e80b1b68b3e877bf2ef29f91225bf"></a><!-- doxytag: member="pbx::PBXClient::report" ref="abd8e80b1b68b3e877bf2ef29f91225bf" args="(String style, String str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.report </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>style</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reports a system message to log. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00296">296</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, and <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a1a62c4979a28891c527e28fc9f4b7df4">pbx.PBXClient.Context.report()</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00377">pbx.PBXClient.parseControlMessage()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a1a62c4979a28891c527e28fc9f4b7df4" title="Reports a system message to log.">report</a>( style, str );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="acd24d6bd87194f8ae9b0e1b896385e97"></a><!-- doxytag: member="pbx::PBXClient::reportIncomingTextMessage" ref="acd24d6bd87194f8ae9b0e1b896385e97" args="(String userId, String message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.reportIncomingTextMessage </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>userId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reports incoming message. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00304">304</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, and <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a7bc217a61f777d4959e02e43bd86f624">pbx.PBXClient.Context.reportIncomingTextMessage()</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00321">pbx.PBXClient.parseInputMessage()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#a7bc217a61f777d4959e02e43bd86f624" title="Reports incoming textual message.">reportIncomingTextMessage</a>( <span class="stringliteral">&quot;chatMessage&quot;</span>, userId, message );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a19f37c8db5173cc41f99d4a887a962ff"></a><!-- doxytag: member="pbx::PBXClient::run" ref="a19f37c8db5173cc41f99d4a887a962ff" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.run </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Connects socket, then reads messages from server while <code>running</code> flag is enabled. </p>
<p>Finally, closes connection in graceful manner.</p>
<p>Incoming messages are dispatched to the owner via the call-back context (see <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html" title="Provides a call-back context for the instance of PBXClient.">PBXClient.Context</a>). </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00629">629</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00164">pbx.PBXClient.host</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00159">pbx.PBXClient.INFO</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00174">pbx.PBXClient.myID</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00179">pbx.PBXClient.out</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00321">pbx.PBXClient.parseInputMessage()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00169">pbx.PBXClient.port</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00296">pbx.PBXClient.report()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00189">pbx.PBXClient.running</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ac358fa7d4c89419d73b29501171d18a2">pbx.PBXClient.Context.setPbxStatus()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00184">pbx.PBXClient.socket</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00154">pbx.PBXClient.WARN</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <a class="code" href="namespaceutils.html#acdfe27a467c82e100aa74ce6d94e9b71" title="Common application message logger facility (static implementation)">Log</a>.trace( <span class="stringliteral">&quot;Thread started&quot;</span> );
<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* Open connection</span>
<span class="comment">         */</span>
        <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5015382f590ad4c70435467c9f662adf" title="HTML CSS class for info messages.">INFO</a>, <span class="stringliteral">&quot;Connecting to &quot;</span> + <a class="code" href="classpbx_1_1_p_b_x_client.html#acf9f2f6dd971fa08f1781a197545d2db" title="Chat client ID when presented to user (== host + &amp;quot;:&amp;quot; + port)">myID</a> + <span class="stringliteral">&quot;...&quot;</span> );
        <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ac358fa7d4c89419d73b29501171d18a2" title="Updates PBX status message of the parent.">setPbxStatus</a>( <span class="stringliteral">&quot;Connecting to &quot;</span> + <a class="code" href="classpbx_1_1_p_b_x_client.html#acf9f2f6dd971fa08f1781a197545d2db" title="Chat client ID when presented to user (== host + &amp;quot;:&amp;quot; + port)">myID</a> + <span class="stringliteral">&quot;...&quot;</span> );

        <span class="keywordflow">try</span>
        {
            <span class="keyword">synchronized</span>( this ) {
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a> = <span class="keyword">new</span> Socket( <a class="code" href="classpbx_1_1_p_b_x_client.html#ab7454d4e5bb1676adbcc01e2deb969ef" title="Host name or IP address of the remote chat server.">host</a>, <a class="code" href="classpbx_1_1_p_b_x_client.html#aa4b4cb1c8d43643c2e1d3bbf04f5640a" title="TCP port where to connect to on remote chat server.">port</a> );
            }
        }
        <span class="keywordflow">catch</span>( UnknownHostException e )
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, <span class="stringliteral">&quot;&#39;Unknown host&#39; exception while creating socket&quot;</span> );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, e.toString () );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> = <span class="keyword">false</span>;
        }
        <span class="keywordflow">catch</span>( IOException e )
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, <span class="stringliteral">&quot;I/O exception while connecting&quot;</span> );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, e.toString () );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> = <span class="keyword">false</span>;
        }
<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* Get input stream. Consider input characters UTF-8 encoded.</span>
<span class="comment">         * TODO: It would be nice to have this as a parameter.</span>
<span class="comment">         */</span>
        InputStreamReader reader = null;
        <span class="keywordflow">try</span>
        {
            <span class="keywordflow">if</span> ( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a> != null ) {
                reader = <span class="keyword">new</span> InputStreamReader( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a>.getInputStream (), <span class="stringliteral">&quot;utf-8&quot;</span> );
            }
        }
        <span class="keywordflow">catch</span>( IOException e )
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, <span class="stringliteral">&quot;I/O exception while getting input stream&quot;</span> );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, e.toString () );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> = <span class="keyword">false</span>;
            reader = null;
        }
        <span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* Get output stream. Encode our character strings as UTF-8.</span>
<span class="comment">         */</span>
        <span class="keywordflow">try</span> 
        {
            <span class="keywordflow">if</span> ( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a> != null ) {
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a126e9c82498f32f661bccca6406eba38" title="Output stream to remote server.">out</a> = <span class="keyword">new</span> PrintWriter(
                        <span class="keyword">new</span> OutputStreamWriter( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a>.getOutputStream(), <span class="stringliteral">&quot;utf-8&quot;</span> ),
                        <span class="comment">/*autoflush*/</span> <span class="keyword">true</span> );
            }
        }
        <span class="keywordflow">catch</span>( IOException e )
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, <span class="stringliteral">&quot;I/O exception while getting output stream&quot;</span> );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, e.toString () );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> = <span class="keyword">false</span>;
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a126e9c82498f32f661bccca6406eba38" title="Output stream to remote server.">out</a> = null;
        }
<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* Finally connected... (if running == true survived until here)</span>
<span class="comment">         */</span>
        BufferedReader in = null;
        <span class="keywordflow">if</span> ( <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> )
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ac358fa7d4c89419d73b29501171d18a2" title="Updates PBX status message of the parent.">setPbxStatus</a>( <span class="stringliteral">&quot;Connected to &quot;</span> + <a class="code" href="classpbx_1_1_p_b_x_client.html#acf9f2f6dd971fa08f1781a197545d2db" title="Chat client ID when presented to user (== host + &amp;quot;:&amp;quot; + port)">myID</a> );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <span class="stringliteral">&quot;logOk&quot;</span>, <span class="stringliteral">&quot;Connected to &quot;</span> + <a class="code" href="classpbx_1_1_p_b_x_client.html#acf9f2f6dd971fa08f1781a197545d2db" title="Chat client ID when presented to user (== host + &amp;quot;:&amp;quot; + port)">myID</a> + <span class="stringliteral">&quot;. Ready to communicate...&quot;</span> );
            
            in = <span class="keyword">new</span> BufferedReader( reader );
        }
        <span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* Read messages from the socket and dump them on log area</span>
<span class="comment">         */</span>
        <span class="keywordflow">while</span>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> )
        {
            <span class="keywordflow">try</span>
            {
                <a class="code" href="classpbx_1_1_p_b_x_client.html#aa4ae9bc6badf013485cb63e37adf67e3" title="Parses input message.">parseInputMessage</a>( in.readLine () );
            }
            <span class="keywordflow">catch</span>( IOException e )
            {
                <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, <span class="stringliteral">&quot;Connection lost!&quot;</span> );
                <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, e.toString () );
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> = <span class="keyword">false</span>;
            }
        }

        <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5015382f590ad4c70435467c9f662adf" title="HTML CSS class for info messages.">INFO</a>, <span class="stringliteral">&quot;Closing connection &quot;</span> + <a class="code" href="classpbx_1_1_p_b_x_client.html#acf9f2f6dd971fa08f1781a197545d2db" title="Chat client ID when presented to user (== host + &amp;quot;:&amp;quot; + port)">myID</a> + <span class="stringliteral">&quot;...&quot;</span> );
<span class="comment"></span>
<span class="comment">        //////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>        <span class="comment">/* Close connection gracefully</span>
<span class="comment">         */</span>
        <span class="keywordflow">try</span>
        {
            <span class="keywordflow">if</span> ( <a class="code" href="classpbx_1_1_p_b_x_client.html#a126e9c82498f32f661bccca6406eba38" title="Output stream to remote server.">out</a> != null ) {
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a126e9c82498f32f661bccca6406eba38" title="Output stream to remote server.">out</a>.close ();
            }
            <span class="keywordflow">if</span> ( in != null ) {
                in.close ();
            }
            <span class="keyword">synchronized</span>( this )
            {
                <span class="keywordflow">if</span> ( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a> != null &amp;&amp; ! <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a>.isClosed () ) {
                    <a class="code" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d" title="Instance of the TCP socket to chat server.">socket</a>.close ();
                }
            }
        }
        <span class="keywordflow">catch</span>( IOException e )
        {
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, <span class="stringliteral">&quot;I/O exception while closing connection&quot;</span> );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c" title="HTML CSS class for warning and error messages.">WARN</a>, e.toString () );
        }
        
        <a class="code" href="classpbx_1_1_p_b_x_client.html#abd8e80b1b68b3e877bf2ef29f91225bf" title="Reports a system message to log.">report</a>( <a class="code" href="classpbx_1_1_p_b_x_client.html#a5015382f590ad4c70435467c9f662adf" title="HTML CSS class for info messages.">INFO</a>, <span class="stringliteral">&quot;... connection closed &quot;</span> + <a class="code" href="classpbx_1_1_p_b_x_client.html#acf9f2f6dd971fa08f1781a197545d2db" title="Chat client ID when presented to user (== host + &amp;quot;:&amp;quot; + port)">myID</a> );
        <a class="code" href="namespaceutils.html#acdfe27a467c82e100aa74ce6d94e9b71" title="Common application message logger facility (static implementation)">Log</a>.trace( <span class="stringliteral">&quot;Thread completed&quot;</span> );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a1f32adf70dcb2b5efc78ef00a22bf39d"></a><!-- doxytag: member="pbx::PBXClient::send" ref="a1f32adf70dcb2b5efc78ef00a22bf39d" args="(String message, String userId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.send </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>userId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends message (appended with new-line) to chat server prefixed with userId. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>message to be sent </td></tr>
    <tr><td class="paramname">userId</td><td>user identifier </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00263">263</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00244">pbx.PBXClient.send()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="comment">/* Discard spaces from the userId first</span>
<span class="comment">         */</span>
        userId = userId.trim().replaceAll( <span class="stringliteral">&quot;\\s{1,}&quot;</span>, <span class="stringliteral">&quot;-&quot;</span> ); 
        
        <span class="comment">/* Send message with userId as a prefix</span>
<span class="comment">         */</span>
        <a class="code" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" title="Sends message (appended with new-line) to chat server.">send</a>( userId + <span class="stringliteral">&quot; :: &quot;</span> + message );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a445ccab5e5e2ca5ad2ec3b1d1d28fdb2"></a><!-- doxytag: member="pbx::PBXClient::send" ref="a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" args="(String message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.send </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>message</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends message (appended with new-line) to chat server. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>message to be sent </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00244">244</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00179">pbx.PBXClient.out</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00377">pbx.PBXClient.parseControlMessage()</a>, <a class="el" href="_crypto_phone_app_8java_source.html#l01054">CryptoPhoneApp.parseInputMessage()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00263">pbx.PBXClient.send()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00583">pbx.PBXClient.sendAccept()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00595">pbx.PBXClient.sendBye()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00606">pbx.PBXClient.sendInstantMessage()</a>, <a class="el" href="_crypto_phone_app_8java_source.html#l01121">CryptoPhoneApp.sendInstantMessage()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00559">pbx.PBXClient.sendInvite()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00615">pbx.PBXClient.sendListPeers()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00571">pbx.PBXClient.sendRing()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keyword">synchronized</span>( this )
        {
            <span class="keywordflow">if</span> ( <a class="code" href="classpbx_1_1_p_b_x_client.html#a126e9c82498f32f661bccca6406eba38" title="Output stream to remote server.">out</a> == null || message == null ) {
                <span class="keywordflow">return</span>;
            }
            
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a126e9c82498f32f661bccca6406eba38" title="Output stream to remote server.">out</a>.println( message );
            <a class="code" href="classpbx_1_1_p_b_x_client.html#a126e9c82498f32f661bccca6406eba38" title="Output stream to remote server.">out</a>.flush ();
        }
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a712b7b704d26d0974da6a6161f7eff6d"></a><!-- doxytag: member="pbx::PBXClient::sendAccept" ref="a712b7b704d26d0974da6a6161f7eff6d" args="(String remoteUserId, String localIpAddress, int localUdpPort, String publicKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.sendAccept </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>remoteUserId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>localIpAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>localUdpPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>publicKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Broadcasts ACCEPT message. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00583">583</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030">pbx.PBXClient.Context.getUserId()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00244">pbx.PBXClient.send()</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01857">CryptoPhoneApp.acceptIncomingCall()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" title="Sends message (appended with new-line) to chat server.">send</a>( <span class="stringliteral">&quot;[$] ACCEPT &quot;</span> + remoteUserId + <span class="stringliteral">&quot; &quot;</span> 
                + localIpAddress + <span class="stringliteral">&quot; &quot;</span>  + localUdpPort 
                + ( publicKey != null ? <span class="stringliteral">&quot; &quot;</span> + publicKey : <span class="stringliteral">&quot;&quot;</span> ),
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030" title="Returns configured user ID.">getUserId</a> () );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a0d3465a16cbcbe10f04292cb091d0699"></a><!-- doxytag: member="pbx::PBXClient::sendBye" ref="a0d3465a16cbcbe10f04292cb091d0699" args="(String remoteUserId, String localIpAddress, int localUdpPort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.sendBye </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>remoteUserId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>localIpAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>localUdpPort</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Broadcasts BYE message. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00595">595</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030">pbx.PBXClient.Context.getUserId()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00244">pbx.PBXClient.send()</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01501">CryptoPhoneApp.deferredOnInvite()</a>, and <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" title="Sends message (appended with new-line) to chat server.">send</a>( <span class="stringliteral">&quot;[$] BYE &quot;</span> + remoteUserId + <span class="stringliteral">&quot; &quot;</span> 
                + localIpAddress + <span class="stringliteral">&quot; &quot;</span>  + localUdpPort, 
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030" title="Returns configured user ID.">getUserId</a> () );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a54cfb627d993b20c25c3ebf701ea6815"></a><!-- doxytag: member="pbx::PBXClient::sendInstantMessage" ref="a54cfb627d993b20c25c3ebf701ea6815" args="(String remoteUserId, String encryptedMessage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.sendInstantMessage </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>remoteUserId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>encryptedMessage</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Broadcasts IMSG message. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00606">606</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030">pbx.PBXClient.Context.getUserId()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00244">pbx.PBXClient.send()</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01121">CryptoPhoneApp.sendInstantMessage()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" title="Sends message (appended with new-line) to chat server.">send</a>( <span class="stringliteral">&quot;[$] IMSG &quot;</span> + remoteUserId + <span class="stringliteral">&quot; &quot;</span> + encryptedMessage, 
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030" title="Returns configured user ID.">getUserId</a> () );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a726928c4342761e6a39a96e02365d638"></a><!-- doxytag: member="pbx::PBXClient::sendInvite" ref="a726928c4342761e6a39a96e02365d638" args="(String remoteUserId, String localIpAddress, int localUdpPort, String publicKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.sendInvite </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>remoteUserId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>localIpAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>localUdpPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>publicKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Broadcasts INVITE message. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00559">559</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030">pbx.PBXClient.Context.getUserId()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00244">pbx.PBXClient.send()</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" title="Sends message (appended with new-line) to chat server.">send</a>( <span class="stringliteral">&quot;[$] INVITE &quot;</span> + remoteUserId + <span class="stringliteral">&quot; &quot;</span> 
                + localIpAddress + <span class="stringliteral">&quot; &quot;</span>  + localUdpPort 
                + ( publicKey != null ? <span class="stringliteral">&quot; &quot;</span> + publicKey : <span class="stringliteral">&quot;&quot;</span> ),
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030" title="Returns configured user ID.">getUserId</a> () );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a3897d8ee1ed84c9946698d33057c4b79"></a><!-- doxytag: member="pbx::PBXClient::sendListPeers" ref="a3897d8ee1ed84c9946698d33057c4b79" args="(String regex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.sendListPeers </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>regex</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Broadcasts LIST message (to list potential peers) </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00615">615</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030">pbx.PBXClient.Context.getUserId()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00244">pbx.PBXClient.send()</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" title="Sends message (appended with new-line) to chat server.">send</a>( <span class="stringliteral">&quot;[$] LIST&quot;</span> + ( regex != null ? <span class="stringliteral">&quot; &quot;</span> + regex : <span class="stringliteral">&quot;&quot;</span> ),
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030" title="Returns configured user ID.">getUserId</a> () );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="ac80b3f374d478cc3e2333baaa6905840"></a><!-- doxytag: member="pbx::PBXClient::sendRing" ref="ac80b3f374d478cc3e2333baaa6905840" args="(String remoteUserId, String localIpAddress, int localUdpPort, String publicKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.sendRing </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>remoteUserId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>localIpAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>localUdpPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>publicKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Broadcasts RING message. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00571">571</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00194">pbx.PBXClient.context</a>, <a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030">pbx.PBXClient.Context.getUserId()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00244">pbx.PBXClient.send()</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01501">CryptoPhoneApp.deferredOnInvite()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        this.<a class="code" href="classpbx_1_1_p_b_x_client.html#a445ccab5e5e2ca5ad2ec3b1d1d28fdb2" title="Sends message (appended with new-line) to chat server.">send</a>( <span class="stringliteral">&quot;[$] RING &quot;</span> + remoteUserId + <span class="stringliteral">&quot; &quot;</span> 
                + localIpAddress + <span class="stringliteral">&quot; &quot;</span>  + localUdpPort 
                + ( publicKey != null ? <span class="stringliteral">&quot; &quot;</span> + publicKey : <span class="stringliteral">&quot;&quot;</span> ),
                <a class="code" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324" title="Event (call-back) context for this instance of the PBXClient.">context</a>.<a class="code" href="interfacepbx_1_1_p_b_x_client_1_1_context.html#ae72d145d91aaf4a94984b31968ad2030" title="Returns configured user ID.">getUserId</a> () );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a62086db6e1497d23af966f87c148945e"></a><!-- doxytag: member="pbx::PBXClient::start" ref="a62086db6e1497d23af966f87c148945e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx.PBXClient.start </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts the thread. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00229">229</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>References <a class="el" href="_p_b_x_client_8java_source.html#l00189">pbx.PBXClient.running</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l00195">CryptoPhoneApp.CryptoPhoneApp()</a>, <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>, and <a class="el" href="_crypto_phone_app_8java_source.html#l00738">CryptoPhoneApp.mainTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">if</span> ( isAlive () || <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> ) {
            <span class="keywordflow">return</span>;  <span class="comment">// Allow only one thread per instance</span>
        }

        <a class="code" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53" title="Indicates/enables the thread to be running.">running</a> = <span class="keyword">true</span>;
        super.start ();
    }
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a02ab46a6e71f3e5855f604eeb55ad324"></a><!-- doxytag: member="pbx::PBXClient::context" ref="a02ab46a6e71f3e5855f604eeb55ad324" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="interfacepbx_1_1_p_b_x_client_1_1_context.html">Context</a> <a class="el" href="classpbx_1_1_p_b_x_client.html#a02ab46a6e71f3e5855f604eeb55ad324">pbx.PBXClient.context</a> = null<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Event (call-back) context for this instance of the <a class="el" href="classpbx_1_1_p_b_x_client.html" title="Encapsulates rudimentary functionality of a PBX to list and invite users (peers) to secure calls...">PBXClient</a>. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00194">194</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00377">pbx.PBXClient.parseControlMessage()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00206">pbx.PBXClient.PBXClient()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00296">pbx.PBXClient.report()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00304">pbx.PBXClient.reportIncomingTextMessage()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00583">pbx.PBXClient.sendAccept()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00595">pbx.PBXClient.sendBye()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00606">pbx.PBXClient.sendInstantMessage()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00559">pbx.PBXClient.sendInvite()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00615">pbx.PBXClient.sendListPeers()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00571">pbx.PBXClient.sendRing()</a>.</p>

</div>
</div>
<a class="anchor" id="ab7454d4e5bb1676adbcc01e2deb969ef"></a><!-- doxytag: member="pbx::PBXClient::host" ref="ab7454d4e5bb1676adbcc01e2deb969ef" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String <a class="el" href="classpbx_1_1_p_b_x_client.html#ab7454d4e5bb1676adbcc01e2deb969ef">pbx.PBXClient.host</a> = null<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Host name or IP address of the remote chat server. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00164">164</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00377">pbx.PBXClient.parseControlMessage()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00206">pbx.PBXClient.PBXClient()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>.</p>

</div>
</div>
<a class="anchor" id="a5015382f590ad4c70435467c9f662adf"></a><!-- doxytag: member="pbx::PBXClient::INFO" ref="a5015382f590ad4c70435467c9f662adf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">final String <a class="el" href="classpbx_1_1_p_b_x_client.html#a5015382f590ad4c70435467c9f662adf">pbx.PBXClient.INFO</a> = &quot;logInfo&quot;<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>HTML CSS class for info messages. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00159">159</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00377">pbx.PBXClient.parseControlMessage()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>.</p>

</div>
</div>
<a class="anchor" id="acf9f2f6dd971fa08f1781a197545d2db"></a><!-- doxytag: member="pbx::PBXClient::myID" ref="acf9f2f6dd971fa08f1781a197545d2db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String <a class="el" href="classpbx_1_1_p_b_x_client.html#acf9f2f6dd971fa08f1781a197545d2db">pbx.PBXClient.myID</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Chat client ID when presented to user (== host + ":" + port) </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00174">174</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00206">pbx.PBXClient.PBXClient()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>.</p>

</div>
</div>
<a class="anchor" id="a126e9c82498f32f661bccca6406eba38"></a><!-- doxytag: member="pbx::PBXClient::out" ref="a126e9c82498f32f661bccca6406eba38" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PrintWriter <a class="el" href="classpbx_1_1_p_b_x_client.html#a126e9c82498f32f661bccca6406eba38">pbx.PBXClient.out</a> = null<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Output stream to remote server. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00179">179</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00244">pbx.PBXClient.send()</a>.</p>

</div>
</div>
<a class="anchor" id="aa4b4cb1c8d43643c2e1d3bbf04f5640a"></a><!-- doxytag: member="pbx::PBXClient::port" ref="aa4b4cb1c8d43643c2e1d3bbf04f5640a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classpbx_1_1_p_b_x_client.html#aa4b4cb1c8d43643c2e1d3bbf04f5640a">pbx.PBXClient.port</a> = -1<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>TCP port where to connect to on remote chat server. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00169">169</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00377">pbx.PBXClient.parseControlMessage()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00206">pbx.PBXClient.PBXClient()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>.</p>

</div>
</div>
<a class="anchor" id="a129cf7dd7d500a8ccd3eedf44592dd53"></a><!-- doxytag: member="pbx::PBXClient::running" ref="a129cf7dd7d500a8ccd3eedf44592dd53" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile boolean <a class="el" href="classpbx_1_1_p_b_x_client.html#a129cf7dd7d500a8ccd3eedf44592dd53">pbx.PBXClient.running</a> = false<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Indicates/enables the thread to be running. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00189">189</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00277">pbx.PBXClient.close()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00229">pbx.PBXClient.start()</a>.</p>

</div>
</div>
<a class="anchor" id="a5365c6d73f90b8501b1512bf379d0e9d"></a><!-- doxytag: member="pbx::PBXClient::socket" ref="a5365c6d73f90b8501b1512bf379d0e9d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Socket <a class="el" href="classpbx_1_1_p_b_x_client.html#a5365c6d73f90b8501b1512bf379d0e9d">pbx.PBXClient.socket</a> = null<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Instance of the TCP socket to chat server. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00184">184</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00277">pbx.PBXClient.close()</a>, <a class="el" href="_p_b_x_client_8java_source.html#l00220">pbx.PBXClient.getLocalAddress()</a>, and <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>.</p>

</div>
</div>
<a class="anchor" id="a8903bf28bd6cf77a754cea13c1890a4c"></a><!-- doxytag: member="pbx::PBXClient::WARN" ref="a8903bf28bd6cf77a754cea13c1890a4c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">final String <a class="el" href="classpbx_1_1_p_b_x_client.html#a8903bf28bd6cf77a754cea13c1890a4c">pbx.PBXClient.WARN</a> = &quot;logWarn&quot;<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>HTML CSS class for warning and error messages. </p>

<p>Definition at line <a class="el" href="_p_b_x_client_8java_source.html#l00154">154</a> of file <a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a>.</p>

<p>Referenced by <a class="el" href="_p_b_x_client_8java_source.html#l00629">pbx.PBXClient.run()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>pbx/<a class="el" href="_p_b_x_client_8java_source.html">PBXClient.java</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Dec 16 2010 14:44:44 for VoIP Kryptofon by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
