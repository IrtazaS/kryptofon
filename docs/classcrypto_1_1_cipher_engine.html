<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>VoIP Kryptofon: crypto.CipherEngine Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="namespacecrypto.html">crypto</a>      </li>
      <li><a class="el" href="classcrypto_1_1_cipher_engine.html">CipherEngine</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a>  </div>
  <div class="headertitle">
<h1>crypto.CipherEngine Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="crypto::CipherEngine" -->
<p>Common ciphering engine (for the whole application) providing:  
<a href="#_details">More...</a></p>
<!-- startSectionHeader --><div class="dynheader">
Collaboration diagram for crypto.CipherEngine:<!-- endSectionHeader --></div>
<!-- startSectionSummary --><!-- endSectionSummary --><!-- startSectionContent --><div class="dyncontent">
<div class="center"><img src="classcrypto_1_1_cipher_engine__coll__graph.png" border="0" usemap="#crypto_8_cipher_engine_coll__map" alt="Collaboration graph"/></div>
<map name="crypto_8_cipher_engine_coll__map" id="crypto_8_cipher_engine_coll__map">
<area shape="rect" id="node2" href="classcrypto_1_1_symmetric_cipher.html" title="Instances of the Symmetric cipher class arew used to cipher peer&#45;to&#45;peer datagram packets..." alt="" coords="293,261,456,589"/><area shape="rect" id="node8" href="classcrypto_1_1_asymmetric_cipher.html" title="Implements asymmetric cipher with public and private keys used to retrieve secret key (used for symme..." alt="" coords="32,157,269,693"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center><!-- endSectionContent --></div>

<p><a href="classcrypto_1_1_cipher_engine-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a2cfd94274b066bcdff57a526307fc059">getPrivateKeyDirectory</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns path to the directory holding our private key.  <a href="#a2cfd94274b066bcdff57a526307fc059"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a38f67ebc9042fb87a889aa9f1cecc60b">getSignedPublicKey</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns serialized signed public key (used for encryption of datagrams) as Base64 string.  <a href="#a38f67ebc9042fb87a889aa9f1cecc60b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a721ff59dcda3d21c6a4f9f201fd6442b">getNamedPublicKey</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns serialized named public key encoded as Base64 string.  <a href="#a721ff59dcda3d21c6a4f9f201fd6442b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classcrypto_1_1_symmetric_cipher.html">SymmetricCipher</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#aaa906efe34d4247419b18e7dc7138b59">getCipher</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns local symmetric ciphering engine.  <a href="#aaa906efe34d4247419b18e7dc7138b59"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static SignedObject&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a7bb9b8a2f297c37b2e72005260f758fa">getSignedSecretKey</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns secret key signed with our private key.  <a href="#a7bb9b8a2f297c37b2e72005260f758fa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classcrypto_1_1_symmetric_cipher.html">SymmetricCipher</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#ac894772649ab2e9cf4bf60eebb27872c">deserializeEncryptedSecretKey</a> (String encryptedSecret)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reconstructs secret key from Base64 respresentation of encrypted (using our public key) serialized secret key and verifies signature of the remote peer.  <a href="#ac894772649ab2e9cf4bf60eebb27872c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#ab26ea3dd20fb07e00104c42651cb2d23">initialize</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads authorized public keys and initializes asymmetric and symmetric ciphering engines, where:  <a href="#ab26ea3dd20fb07e00104c42651cb2d23"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a0e78d429ba772508a03df9f2a0dcb88d">reloadAuthorizedPublicKeys</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reloads only authorized public keys.  <a href="#a0e78d429ba772508a03df9f2a0dcb88d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#ac0d39891a33a85d56cb50ba1b00b22ec">generateNewSecret</a> (String algorithm, int keySize, boolean verbose)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates new symmetric secret key.  <a href="#ac0d39891a33a85d56cb50ba1b00b22ec"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classcrypto_1_1_asymmetric_cipher.html">AsymmetricCipher</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7">privateCipher</a> = null</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Asymmetric cipher used to encrypt secret keys.  <a href="#a7fd3ac037e3c86a45c1bef64271dc4d7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static final String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a4fd13e98aa21ae0d67d0965a3aff766c">myCipherAlgorithm</a> = &quot;Blowfish&quot;</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The default cipher algorithm for data (PDUs and secret chat messages)  <a href="#a4fd13e98aa21ae0d67d0965a3aff766c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static final int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a6ff861b9b5df11d08ac1aecb737133d0">myCipherKeySize</a> = 32</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The default key size for cipher algorithm.  <a href="#a6ff861b9b5df11d08ac1aecb737133d0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static final String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a641fb28072d928d174a6dd36a3434229">defaultPrivateKeyDirectory</a> = &quot;.mykf&quot;</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Subdirectory of the user.home where private key is stored.  <a href="#a641fb28072d928d174a6dd36a3434229"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a38d1bb907c77b95b794c406361b5f8ab">myPrivateKeyPath</a> = &quot;&quot;</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Full path of the directory holding our private key.  <a href="#a38d1bb907c77b95b794c406361b5f8ab"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classcrypto_1_1_symmetric_cipher.html">SymmetricCipher</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcrypto_1_1_cipher_engine.html#a645d535cf7c541a4671518903645ca87">myPduCipher</a> = null</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Symmetric cipher used to encrypt data (PDUs and secret chat messages)  <a href="#a645d535cf7c541a4671518903645ca87"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Common ciphering engine (for the whole application) providing: </p>
<ul>
<li>Asymmetric ciphering: used for signing/verification and encryption/decryption of secret key used in symmetric ciphering.</li>
</ul>
<ul>
<li>Symmetric ciphering: used for encryption/decryption of PDUs and secret chat text messages. </li>
</ul>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00022">22</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ac894772649ab2e9cf4bf60eebb27872c"></a><!-- doxytag: member="crypto::CipherEngine::deserializeEncryptedSecretKey" ref="ac894772649ab2e9cf4bf60eebb27872c" args="(String encryptedSecret)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classcrypto_1_1_symmetric_cipher.html">SymmetricCipher</a> crypto.CipherEngine.deserializeEncryptedSecretKey </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>encryptedSecret</em>&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reconstructs secret key from Base64 respresentation of encrypted (using our public key) serialized secret key and verifies signature of the remote peer. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00112">112</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>References <a class="el" href="_asymmetric_cipher_8java_source.html#l00598">crypto.AsymmetricCipher.deserializeEncryptedSecretKey()</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00027">crypto.CipherEngine.privateCipher</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01624">CryptoPhoneApp.deferredOnAccept()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">if</span> ( <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a> == null ) {
            <span class="keywordflow">return</span> null;
        }
        
        <span class="keywordflow">return</span> <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a>.deserializeEncryptedSecretKey( encryptedSecret );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="ac0d39891a33a85d56cb50ba1b00b22ec"></a><!-- doxytag: member="crypto::CipherEngine::generateNewSecret" ref="ac0d39891a33a85d56cb50ba1b00b22ec" args="(String algorithm, int keySize, boolean verbose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static boolean crypto.CipherEngine.generateNewSecret </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"> <em>algorithm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>keySize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boolean&#160;</td>
          <td class="paramname"> <em>verbose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generates new symmetric secret key. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if generated cipher may be used (i.e. false in case of error) </dd></dl>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00219">219</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>References <a class="el" href="_symmetric_cipher_8java_source.html#l00142">crypto.SymmetricCipher.isActive()</a>, <a class="el" href="_cipher_engine_8java_source.html#l00032">crypto.CipherEngine.myCipherAlgorithm</a>, <a class="el" href="_cipher_engine_8java_source.html#l00037">crypto.CipherEngine.myCipherKeySize</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00052">crypto.CipherEngine.myPduCipher</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">if</span> ( algorithm == null || algorithm.isEmpty () ) {
            algorithm = <a class="code" href="classcrypto_1_1_cipher_engine.html#a4fd13e98aa21ae0d67d0965a3aff766c" title="The default cipher algorithm for data (PDUs and secret chat messages)">myCipherAlgorithm</a>;
        }

        <span class="keywordflow">if</span> ( keySize &lt;= 0 ) {
            keySize = <a class="code" href="classcrypto_1_1_cipher_engine.html#a6ff861b9b5df11d08ac1aecb737133d0" title="The default key size for cipher algorithm.">myCipherKeySize</a>;
        }

        <a class="code" href="classcrypto_1_1_cipher_engine.html#a645d535cf7c541a4671518903645ca87" title="Symmetric cipher used to encrypt data (PDUs and secret chat messages)">myPduCipher</a> = <span class="keyword">new</span> SymmetricCipher( algorithm, keySize, verbose );
        
        <span class="keywordflow">return</span> <a class="code" href="classcrypto_1_1_cipher_engine.html#a645d535cf7c541a4671518903645ca87" title="Symmetric cipher used to encrypt data (PDUs and secret chat messages)">myPduCipher</a>.isActive ();
    }
</pre></div>
</div>
</div>
<a class="anchor" id="aaa906efe34d4247419b18e7dc7138b59"></a><!-- doxytag: member="crypto::CipherEngine::getCipher" ref="aaa906efe34d4247419b18e7dc7138b59" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classcrypto_1_1_symmetric_cipher.html">SymmetricCipher</a> crypto.CipherEngine.getCipher </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns local symmetric ciphering engine. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00090">90</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>References <a class="el" href="_cipher_engine_8java_source.html#l00052">crypto.CipherEngine.myPduCipher</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01857">CryptoPhoneApp.acceptIncomingCall()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">return</span> <a class="code" href="classcrypto_1_1_cipher_engine.html#a645d535cf7c541a4671518903645ca87" title="Symmetric cipher used to encrypt data (PDUs and secret chat messages)">myPduCipher</a>;
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a721ff59dcda3d21c6a4f9f201fd6442b"></a><!-- doxytag: member="crypto::CipherEngine::getNamedPublicKey" ref="a721ff59dcda3d21c6a4f9f201fd6442b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static String crypto.CipherEngine.getNamedPublicKey </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns serialized named public key encoded as Base64 string. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00078">78</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>References <a class="el" href="_asymmetric_cipher_8java_source.html#l00381">crypto.AsymmetricCipher.getNamedPublicKey()</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00027">crypto.CipherEngine.privateCipher</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">if</span> ( <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a> == null ) {
            <span class="keywordflow">return</span> null;
        }
        
        <span class="keywordflow">return</span> <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a>.getNamedPublicKey ();
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a2cfd94274b066bcdff57a526307fc059"></a><!-- doxytag: member="crypto::CipherEngine::getPrivateKeyDirectory" ref="a2cfd94274b066bcdff57a526307fc059" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static String crypto.CipherEngine.getPrivateKeyDirectory </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns path to the directory holding our private key. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00057">57</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>References <a class="el" href="_cipher_engine_8java_source.html#l00047">crypto.CipherEngine.myPrivateKeyPath</a>.</p>

<p>Referenced by <a class="el" href="_asymmetric_cipher_8java_source.html#l00358">crypto.AsymmetricCipher.exportPublicKey()</a>, <a class="el" href="_public_encryptor_8java_source.html#l00177">crypto.PublicEncryptor.loadAuthorizedPublicKeys()</a>, <a class="el" href="_asymmetric_cipher_8java_source.html#l00175">crypto.AsymmetricCipher.loadSavedKeyPair()</a>, and <a class="el" href="_asymmetric_cipher_8java_source.html#l00202">crypto.AsymmetricCipher.saveKeyPair()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">return</span> <a class="code" href="classcrypto_1_1_cipher_engine.html#a38d1bb907c77b95b794c406361b5f8ab" title="Full path of the directory holding our private key.">myPrivateKeyPath</a>;
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a38f67ebc9042fb87a889aa9f1cecc60b"></a><!-- doxytag: member="crypto::CipherEngine::getSignedPublicKey" ref="a38f67ebc9042fb87a889aa9f1cecc60b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static String crypto.CipherEngine.getSignedPublicKey </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns serialized signed public key (used for encryption of datagrams) as Base64 string. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00066">66</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>References <a class="el" href="_asymmetric_cipher_8java_source.html#l00347">crypto.AsymmetricCipher.getSerializedAndSignedPublicKey()</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00027">crypto.CipherEngine.privateCipher</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01501">CryptoPhoneApp.deferredOnInvite()</a>, and <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">if</span> ( <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a> == null ) {
            <span class="keywordflow">return</span> null;
        }
        
        <span class="keywordflow">return</span> <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a>.getSerializedAndSignedPublicKey ();
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a7bb9b8a2f297c37b2e72005260f758fa"></a><!-- doxytag: member="crypto::CipherEngine::getSignedSecretKey" ref="a7bb9b8a2f297c37b2e72005260f758fa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static SignedObject crypto.CipherEngine.getSignedSecretKey </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns secret key signed with our private key. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00098">98</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>References <a class="el" href="_symmetric_cipher_8java_source.html#l00134">crypto.SymmetricCipher.getSecretKey()</a>, <a class="el" href="_cipher_engine_8java_source.html#l00052">crypto.CipherEngine.myPduCipher</a>, <a class="el" href="_cipher_engine_8java_source.html#l00027">crypto.CipherEngine.privateCipher</a>, and <a class="el" href="_asymmetric_cipher_8java_source.html#l00561">crypto.AsymmetricCipher.signObject()</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01857">CryptoPhoneApp.acceptIncomingCall()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">if</span> ( <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a> == null ) {
            <span class="keywordflow">return</span> null;
        }
        
        <span class="keywordflow">return</span> <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a>.signObject( <a class="code" href="classcrypto_1_1_cipher_engine.html#a645d535cf7c541a4671518903645ca87" title="Symmetric cipher used to encrypt data (PDUs and secret chat messages)">myPduCipher</a>.getSecretKey () );
    }
</pre></div>
</div>
</div>
<a class="anchor" id="ab26ea3dd20fb07e00104c42651cb2d23"></a><!-- doxytag: member="crypto::CipherEngine::initialize" ref="ab26ea3dd20fb07e00104c42651cb2d23" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void crypto.CipherEngine.initialize </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Loads authorized public keys and initializes asymmetric and symmetric ciphering engines, where: </p>
<ul>
<li>Asymmetric ciphering is used for verification and encryption/decryption of secret key used in symmetric ciphering.</li>
<li>Symmetric ciphering is used for encryption/decryption of PDUs and secret chat text messages.</li>
</ul>
<p>Initialization is non-blocking and performed in separate worker thread. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00132">132</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>References <a class="el" href="_cipher_engine_8java_source.html#l00042">crypto.CipherEngine.defaultPrivateKeyDirectory</a>, <a class="el" href="_public_encryptor_8java_source.html#l00177">crypto.PublicEncryptor.loadAuthorizedPublicKeys()</a>, <a class="el" href="_cipher_engine_8java_source.html#l00032">crypto.CipherEngine.myCipherAlgorithm</a>, <a class="el" href="_cipher_engine_8java_source.html#l00037">crypto.CipherEngine.myCipherKeySize</a>, <a class="el" href="_cipher_engine_8java_source.html#l00052">crypto.CipherEngine.myPduCipher</a>, <a class="el" href="_cipher_engine_8java_source.html#l00047">crypto.CipherEngine.myPrivateKeyPath</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00027">crypto.CipherEngine.privateCipher</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l00195">CryptoPhoneApp.CryptoPhoneApp()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="comment">/* Create directory that will hold private key. Also change permissions using </span>
<span class="comment">         * native OS &#39;chmod&#39; command (ignoring Windows), so that no one but the </span>
<span class="comment">         * owner might read its contents.</span>
<span class="comment">         */</span>
        <span class="keywordflow">try</span>
        {
            <a class="code" href="classcrypto_1_1_cipher_engine.html#a38d1bb907c77b95b794c406361b5f8ab" title="Full path of the directory holding our private key.">myPrivateKeyPath</a> = <span class="stringliteral">&quot;&quot;</span>;
            
            String dirPath = System.getProperty( <span class="stringliteral">&quot;user.home&quot;</span> )
                           + System.getProperty( <span class="stringliteral">&quot;file.separator&quot;</span> )
                           + <a class="code" href="classcrypto_1_1_cipher_engine.html#a641fb28072d928d174a6dd36a3434229" title="Subdirectory of the user.home where private key is stored.">defaultPrivateKeyDirectory</a>;

            File directory = <span class="keyword">new</span> File( dirPath );

            <span class="keywordflow">if</span> (  ! directory.exists () ) {
                directory.mkdir ();
            }

            <span class="keywordflow">if</span> (  directory.exists () )
            {
                <a class="code" href="classcrypto_1_1_cipher_engine.html#a38d1bb907c77b95b794c406361b5f8ab" title="Full path of the directory holding our private key.">myPrivateKeyPath</a> = dirPath + System.getProperty( <span class="stringliteral">&quot;file.separator&quot;</span> );
                
                String osName = System.getProperty( <span class="stringliteral">&quot;os.name&quot;</span> ).toLowerCase();
                <span class="keywordflow">if</span> ( ! osName.matches( <span class="stringliteral">&quot;^.*windows.*$&quot;</span> ) ) 
                {
                    <span class="keywordflow">try</span> 
                    {
                        Runtime.getRuntime().exec( <span class="keyword">new</span> String[] { <span class="stringliteral">&quot;chmod&quot;</span>, <span class="stringliteral">&quot;go=&quot;</span>, dirPath } );
                    }
                    <span class="keywordflow">catch</span>( IOException e ) 
                    {
                        <a class="code" href="namespaceutils.html#acdfe27a467c82e100aa74ce6d94e9b71" title="Common application message logger facility (static implementation)">Log</a>.trace( <span class="stringliteral">&quot;Failed to do chmod; OS = &quot;</span> + osName );
                        <a class="code" href="namespaceutils.html#acdfe27a467c82e100aa74ce6d94e9b71" title="Common application message logger facility (static implementation)">Log</a>.exception( <a class="code" href="namespaceutils.html#acdfe27a467c82e100aa74ce6d94e9b71" title="Common application message logger facility (static implementation)">Log</a>.TRACE, e );
                    }
                }
            }
        }
        <span class="keywordflow">catch</span>( Exception e )
        {
            <a class="code" href="namespaceutils.html#acdfe27a467c82e100aa74ce6d94e9b71" title="Common application message logger facility (static implementation)">Log</a>.exception( <a class="code" href="namespaceutils.html#acdfe27a467c82e100aa74ce6d94e9b71" title="Common application message logger facility (static implementation)">Log</a>.ERROR, e );
        }
            
        <a class="code" href="namespaceutils.html#acdfe27a467c82e100aa74ce6d94e9b71" title="Common application message logger facility (static implementation)">Log</a>.trace( <span class="stringliteral">&quot;Private Key directory: &quot;</span> + <a class="code" href="classcrypto_1_1_cipher_engine.html#a38d1bb907c77b95b794c406361b5f8ab" title="Full path of the directory holding our private key.">myPrivateKeyPath</a> );

        <span class="comment">/* Initialize (load or generate) private/public keys and</span>
<span class="comment">         * generate secret key in worker thread, then load authorized public keys. </span>
<span class="comment">         */</span>
        Runnable nonBlockingInitThread = <span class="keyword">new</span> Runnable () 
        {
            @Override
            <span class="keyword">public</span> <span class="keywordtype">void</span> run() 
            {
                <span class="comment">/* Instantiate our ciphers first...</span>
<span class="comment">                 */</span>
                <span class="keywordflow">if</span> ( <a class="code" href="classcrypto_1_1_cipher_engine.html#a645d535cf7c541a4671518903645ca87" title="Symmetric cipher used to encrypt data (PDUs and secret chat messages)">myPduCipher</a> == null ) {
                    <a class="code" href="classcrypto_1_1_cipher_engine.html#a645d535cf7c541a4671518903645ca87" title="Symmetric cipher used to encrypt data (PDUs and secret chat messages)">myPduCipher</a> = <span class="keyword">new</span> SymmetricCipher( 
                            <a class="code" href="classcrypto_1_1_cipher_engine.html#a4fd13e98aa21ae0d67d0965a3aff766c" title="The default cipher algorithm for data (PDUs and secret chat messages)">myCipherAlgorithm</a>, <a class="code" href="classcrypto_1_1_cipher_engine.html#a6ff861b9b5df11d08ac1aecb737133d0" title="The default key size for cipher algorithm.">myCipherKeySize</a>, <span class="comment">/*report*/</span> <span class="keyword">false</span> );
                }

                <span class="keywordflow">if</span> ( <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a> == null ) {
                    <a class="code" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7" title="Asymmetric cipher used to encrypt secret keys.">privateCipher</a> = <span class="keyword">new</span> AsymmetricCipher ();
                }
                
                <span class="comment">/* ...then load authorized public keys</span>
<span class="comment">                 */</span>
                PublicEncryptor.loadAuthorizedPublicKeys ();
            }
        };

        ( <span class="keyword">new</span> Thread( nonBlockingInitThread, <span class="stringliteral">&quot;CipherEngine&quot;</span> ) ).start ();
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a0e78d429ba772508a03df9f2a0dcb88d"></a><!-- doxytag: member="crypto::CipherEngine::reloadAuthorizedPublicKeys" ref="a0e78d429ba772508a03df9f2a0dcb88d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void crypto.CipherEngine.reloadAuthorizedPublicKeys </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reloads only authorized public keys. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00209">209</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>References <a class="el" href="_public_encryptor_8java_source.html#l00177">crypto.PublicEncryptor.loadAuthorizedPublicKeys()</a>.</p>

<p>Referenced by <a class="el" href="_crypto_phone_app_8java_source.html#l01188">CryptoPhoneApp.executeCommand()</a>.</p>
<div class="fragment"><pre class="fragment">    {
        PublicEncryptor.loadAuthorizedPublicKeys ();
    }
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a641fb28072d928d174a6dd36a3434229"></a><!-- doxytag: member="crypto::CipherEngine::defaultPrivateKeyDirectory" ref="a641fb28072d928d174a6dd36a3434229" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">final String <a class="el" href="classcrypto_1_1_cipher_engine.html#a641fb28072d928d174a6dd36a3434229">crypto.CipherEngine.defaultPrivateKeyDirectory</a> = &quot;.mykf&quot;<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Subdirectory of the user.home where private key is stored. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00042">42</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>Referenced by <a class="el" href="_cipher_engine_8java_source.html#l00132">crypto.CipherEngine.initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a4fd13e98aa21ae0d67d0965a3aff766c"></a><!-- doxytag: member="crypto::CipherEngine::myCipherAlgorithm" ref="a4fd13e98aa21ae0d67d0965a3aff766c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">final String <a class="el" href="classcrypto_1_1_cipher_engine.html#a4fd13e98aa21ae0d67d0965a3aff766c">crypto.CipherEngine.myCipherAlgorithm</a> = &quot;Blowfish&quot;<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The default cipher algorithm for data (PDUs and secret chat messages) </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00032">32</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>Referenced by <a class="el" href="_cipher_engine_8java_source.html#l00219">crypto.CipherEngine.generateNewSecret()</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00132">crypto.CipherEngine.initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a6ff861b9b5df11d08ac1aecb737133d0"></a><!-- doxytag: member="crypto::CipherEngine::myCipherKeySize" ref="a6ff861b9b5df11d08ac1aecb737133d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">final int <a class="el" href="classcrypto_1_1_cipher_engine.html#a6ff861b9b5df11d08ac1aecb737133d0">crypto.CipherEngine.myCipherKeySize</a> = 32<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The default key size for cipher algorithm. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00037">37</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>Referenced by <a class="el" href="_cipher_engine_8java_source.html#l00219">crypto.CipherEngine.generateNewSecret()</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00132">crypto.CipherEngine.initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a645d535cf7c541a4671518903645ca87"></a><!-- doxytag: member="crypto::CipherEngine::myPduCipher" ref="a645d535cf7c541a4671518903645ca87" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classcrypto_1_1_symmetric_cipher.html">SymmetricCipher</a> <a class="el" href="classcrypto_1_1_cipher_engine.html#a645d535cf7c541a4671518903645ca87">crypto.CipherEngine.myPduCipher</a> = null<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Symmetric cipher used to encrypt data (PDUs and secret chat messages) </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00052">52</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>Referenced by <a class="el" href="_cipher_engine_8java_source.html#l00219">crypto.CipherEngine.generateNewSecret()</a>, <a class="el" href="_cipher_engine_8java_source.html#l00090">crypto.CipherEngine.getCipher()</a>, <a class="el" href="_cipher_engine_8java_source.html#l00098">crypto.CipherEngine.getSignedSecretKey()</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00132">crypto.CipherEngine.initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a38d1bb907c77b95b794c406361b5f8ab"></a><!-- doxytag: member="crypto::CipherEngine::myPrivateKeyPath" ref="a38d1bb907c77b95b794c406361b5f8ab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String <a class="el" href="classcrypto_1_1_cipher_engine.html#a38d1bb907c77b95b794c406361b5f8ab">crypto.CipherEngine.myPrivateKeyPath</a> = &quot;&quot;<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Full path of the directory holding our private key. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00047">47</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>Referenced by <a class="el" href="_cipher_engine_8java_source.html#l00057">crypto.CipherEngine.getPrivateKeyDirectory()</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00132">crypto.CipherEngine.initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a7fd3ac037e3c86a45c1bef64271dc4d7"></a><!-- doxytag: member="crypto::CipherEngine::privateCipher" ref="a7fd3ac037e3c86a45c1bef64271dc4d7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classcrypto_1_1_asymmetric_cipher.html">AsymmetricCipher</a> <a class="el" href="classcrypto_1_1_cipher_engine.html#a7fd3ac037e3c86a45c1bef64271dc4d7">crypto.CipherEngine.privateCipher</a> = null<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Asymmetric cipher used to encrypt secret keys. </p>

<p>Definition at line <a class="el" href="_cipher_engine_8java_source.html#l00027">27</a> of file <a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a>.</p>

<p>Referenced by <a class="el" href="_cipher_engine_8java_source.html#l00112">crypto.CipherEngine.deserializeEncryptedSecretKey()</a>, <a class="el" href="_cipher_engine_8java_source.html#l00078">crypto.CipherEngine.getNamedPublicKey()</a>, <a class="el" href="_cipher_engine_8java_source.html#l00066">crypto.CipherEngine.getSignedPublicKey()</a>, <a class="el" href="_cipher_engine_8java_source.html#l00098">crypto.CipherEngine.getSignedSecretKey()</a>, and <a class="el" href="_cipher_engine_8java_source.html#l00132">crypto.CipherEngine.initialize()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>crypto/<a class="el" href="_cipher_engine_8java_source.html">CipherEngine.java</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Dec 16 2010 14:44:44 for VoIP Kryptofon by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
